# 键盘TCP位姿控制器 (C++/OpenCV版)

这是一个使用C++和OpenCV开发的机器人TCP位姿键盘控制程序。程序提供图形化界面，实时显示当前TCP位姿信息，并支持键盘控制机器人运动。

## 功能特性

- **图形化界面**：使用OpenCV窗口显示实时TCP位姿信息
- **实时键盘控制**：支持平移和旋转控制
- **增量运动模式**：基于当前位置的相对运动
- **可调步进值**：通过数字键快速调整运动精度
- **状态显示**：实时显示伺服模式状态和控制参数
- **多输入支持**：同时支持终端和OpenCV窗口的键盘输入

## 控制说明

### 平移控制（X、Y、Z轴）
- `w` / `s` : 前进/后退 (X轴正/负方向)
- `a` / `d` : 左移/右移 (Y轴正/负方向)  
- `Space` / `z` : 上升/下降 (Z轴正/负方向)

### 旋转控制（Rx、Ry、Rz）
- `q` / `e` : 绕Z轴旋转 (Rz 正/负方向)
- `↑` / `↓` : 绕Y轴旋转 (Ry 正/负方向)
- `←` / `→` : 绕X轴旋转 (Rx 正/负方向)

### 设置控制
- `1-9` : 设置步进值为 1-9 mm/度
- `0` : 设置步进值为 10 mm/度
- `r` : 重置到零位（相对于启动位置）
- `ESC` : 退出程序

## 界面说明

### 显示内容
- **TCP位姿信息**：实时显示X、Y、Z位置和Rx、Ry、Rz姿态
- **控制参数**：显示当前步进值、速度、加速度设置
- **控制说明**：界面右侧显示键盘控制说明
- **状态指示**：显示伺服模式是否激活

### 颜色编码
- **白色文字**：标题和标签
- **绿色数值**：位姿数值和激活状态
- **浅灰色**：控制参数和帮助信息
- **红色**：非激活状态

## 使用方法

### 前提条件

1. 确保ROS2环境已正确配置
2. 确保机器人控制服务正在运行
3. 安装OpenCV库（通常已包含在ROS2中）

### 编译和安装

```bash
cd /home/phoenix/roboarm/FairinoDualArm
colcon build --packages-select tools
source install/setup.bash
```

### 运行程序

```bash
# 方法1：直接运行可执行文件
ros2 run tools keyboard_tcp_controller_node

# 方法2：使用启动文件
ros2 launch tools keyboard_tcp_controller.launch.py

# 方法3：指定机器人名称
ros2 launch tools keyboard_tcp_controller.launch.py robot_name:=/R
```

### 操作流程

1. 启动程序后，会出现OpenCV控制窗口
2. 程序会等待机器人服务可用
3. 首次按下运动键时，会自动启动伺服模式
4. 使用键盘控制机器人运动（可在终端或OpenCV窗口中输入）
5. 观察窗口中的实时位姿信息
6. 按ESC键或关闭窗口退出程序

## 技术参数

- **默认步进值**：1.0 mm（平移）/ 1.0 度（旋转）
- **运动速度**：20%
- **加速度**：20%
- **指令周期**：8ms
- **运动模式**：增量运动（基坐标系）
- **显示更新频率**：~100Hz

## 技术实现

### 架构设计
- **ROS2节点**：使用rclcpp框架
- **OpenCV界面**：实时图形化显示
- **多线程设计**：分离ROS事件处理和界面更新
- **异步通信**：非阻塞的服务调用

### 依赖库
- rclcpp
- geometry_msgs
- robo_ctrl (自定义消息和服务)
- OpenCV
- tf2_geometry_msgs

## 安全注意事项

⚠️ **重要提醒**：
- 使用前确保机器人工作空间内无障碍物
- 运动过程中注意观察机器人状态和界面显示
- 遇到异常情况立即按ESC退出
- 首次使用建议设置较小的步进值进行测试
- 确保OpenCV窗口可见，以便观察实时状态

## 故障排除

### 常见问题

1. **服务连接失败**
   - 检查机器人控制节点是否正在运行
   - 确认服务名称是否正确

2. **OpenCV窗口无法显示**
   - 检查X11转发设置（SSH连接时）
   - 确认系统支持图形界面

3. **键盘输入无响应**
   - 确保终端或OpenCV窗口处于焦点状态
   - 检查是否有其他程序占用输入

4. **运动不正确**
   - 检查坐标系设置是否正确
   - 确认步进值是否合适
   - 观察界面中的位姿显示

### 调试信息

程序运行时会输出以下信息：
- 当前TCP位姿（终端日志）
- 伺服模式状态
- 步进值变更
- 错误信息

## 开发信息

- **语言**：C++17
- **框架**：ROS2, OpenCV
- **编译器**：GCC/Clang
- **兼容性**：Linux系统，支持图形界面

## 与Python版本对比

### C++版本优势
- 更高的性能和实时性
- 图形化界面，直观显示状态
- 更低的系统资源占用
- 更好的键盘事件处理

### Python版本优势
- 更简单的开发和调试
- 更好的跨平台兼容性
- 更容易扩展和修改

## 许可证

TODO: 添加许可证信息
